<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="datawhal, RiskControl,">





  <link rel="alternate" href="/atom.xml" title="Ritarma" type="application/atom+xml">






<meta name="description" content="数据预处理12345678910111213141516171819# 确定哪些包是安装好的import pandas as pdimport numpy as npimport matplotlib.pyplot as pltimport seaborn as snsimport datetimefrom tqdm import tqdmfrom sklearn.preprocessing im">
<meta name="keywords" content="datawhal, RiskControl">
<meta property="og:type" content="article">
<meta property="og:title" content="特枕选择和建模">
<meta property="og:url" content="http://yoursite.com/2020/09/22/DW金融风控比赛项目任务一特征选择/index.html">
<meta property="og:site_name" content="Ritarma">
<meta property="og:description" content="数据预处理12345678910111213141516171819# 确定哪些包是安装好的import pandas as pdimport numpy as npimport matplotlib.pyplot as pltimport seaborn as snsimport datetimefrom tqdm import tqdmfrom sklearn.preprocessing im">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2020/09/22/DW金融风控比赛项目任务一特征选择/output_31_1.png">
<meta property="og:updated_time" content="2020-09-22T01:46:27.829Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="特枕选择和建模">
<meta name="twitter:description" content="数据预处理12345678910111213141516171819# 确定哪些包是安装好的import pandas as pdimport numpy as npimport matplotlib.pyplot as pltimport seaborn as snsimport datetimefrom tqdm import tqdmfrom sklearn.preprocessing im">
<meta name="twitter:image" content="http://yoursite.com/2020/09/22/DW金融风控比赛项目任务一特征选择/output_31_1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/09/22/DW金融风控比赛项目任务一特征选择/">





  <title>特枕选择和建模 | Ritarma</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/Ritarma" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ritarma</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/22/DW金融风控比赛项目任务一特征选择/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ritarma Arthur">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ritarma">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">特枕选择和建模</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-22T09:42:24+08:00">
                2020-09-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/09/22/DW金融风控比赛项目任务一特征选择/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2020/09/22/DW金融风控比赛项目任务一特征选择/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/09/22/DW金融风控比赛项目任务一特征选择/" class="leancloud_visitors" data-flag-title="特枕选择和建模">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
                 <span>℃</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  4.6k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确定哪些包是安装好的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> chi2</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">from</span> catboost <span class="keyword">import</span> CatBoostRegressor</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedKFold, KFold</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score, f1_score, roc_auc_score, log_loss</span><br><span class="line">warnings.filterwarnings(<span class="string">'ignore'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_train =pd.read_csv(<span class="string">'./train.csv'</span>)</span><br><span class="line">data_test_a = pd.read_csv(<span class="string">'./testA.csv'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_train.info()</span><br><span class="line">is_default = data_train[<span class="string">'isDefault'</span>]</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 800000 entries, 0 to 799999
Data columns (total 47 columns):
 #   Column              Non-Null Count   Dtype  
---  ------              --------------   -----  
 0   id                  800000 non-null  int64  
 1   loanAmnt            800000 non-null  float64
 2   term                800000 non-null  int64  
 3   interestRate        800000 non-null  float64
 4   installment         800000 non-null  float64
 5   grade               800000 non-null  object 
 6   subGrade            800000 non-null  object 
 7   employmentTitle     799999 non-null  float64
 8   employmentLength    753201 non-null  object 
 9   homeOwnership       800000 non-null  int64  
 10  annualIncome        800000 non-null  float64
 11  verificationStatus  800000 non-null  int64  
 12  issueDate           800000 non-null  object 
 13  isDefault           800000 non-null  int64  
 14  purpose             800000 non-null  int64  
 15  postCode            799999 non-null  float64
 16  regionCode          800000 non-null  int64  
 17  dti                 799761 non-null  float64
 18  delinquency_2years  800000 non-null  float64
 19  ficoRangeLow        800000 non-null  float64
 20  ficoRangeHigh       800000 non-null  float64
 21  openAcc             800000 non-null  float64
 22  pubRec              800000 non-null  float64
 23  pubRecBankruptcies  799595 non-null  float64
 24  revolBal            800000 non-null  float64
 25  revolUtil           799469 non-null  float64
 26  totalAcc            800000 non-null  float64
 27  initialListStatus   800000 non-null  int64  
 28  applicationType     800000 non-null  int64  
 29  earliesCreditLine   800000 non-null  object 
 30  title               799999 non-null  float64
 31  policyCode          800000 non-null  float64
 32  n0                  759730 non-null  float64
 33  n1                  759730 non-null  float64
 34  n2                  759730 non-null  float64
 35  n2.1                759730 non-null  float64
 36  n4                  766761 non-null  float64
 37  n5                  759730 non-null  float64
 38  n6                  759730 non-null  float64
 39  n7                  759730 non-null  float64
 40  n8                  759729 non-null  float64
 41  n9                  759730 non-null  float64
 42  n10                 766761 non-null  float64
 43  n11                 730248 non-null  float64
 44  n12                 759730 non-null  float64
 45  n13                 759730 non-null  float64
 46  n14                 759730 non-null  float64
dtypes: float64(33), int64(9), object(5)
memory usage: 286.9+ MB
</code></pre><h3 id="缺失值填充"><a href="#缺失值填充" class="headerlink" title="缺失值填充"></a>缺失值填充</h3><p> 由于EDA中对缺失的数据发现还有很多，尝试多种缺失填充然后比较结果选择结果最优的一种</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到数值型的特征</span></span><br><span class="line">numerical_fea  = list(data_train.select_dtypes(exclude=[<span class="string">'object'</span>]).columns)</span><br><span class="line"><span class="comment"># 找到非结构化的特征</span></span><br><span class="line">category_fea = list(filter(<span class="keyword">lambda</span> x: x <span class="keyword">not</span> <span class="keyword">in</span> numerical_fea, list(data_train.columns)))</span><br><span class="line"><span class="comment"># 移除‘isDefault’特征</span></span><br><span class="line">numerical_fea.remove(<span class="string">'isDefault'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(len(numerical_fea))</span><br></pre></td></tr></table></figure>
<pre><code>41
</code></pre><p>有三种缺失值填充的方式</p>
<ul>
<li>缺失值替换为指定的值（’0’）</li>
<li>用上面的值替换缺失值</li>
<li>纵向用下面的值来替换，且最多只填充两个连续的</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示缺失值的情况</span></span><br><span class="line">data_train.isnull().sum()</span><br></pre></td></tr></table></figure>
<pre><code>id                        0
loanAmnt                  0
term                      0
interestRate              0
installment               0
grade                     0
subGrade                  0
employmentTitle           1
employmentLength      46799
homeOwnership             0
annualIncome              0
verificationStatus        0
issueDate                 0
isDefault                 0
purpose                   0
postCode                  1
regionCode                0
dti                     239
delinquency_2years        0
ficoRangeLow              0
ficoRangeHigh             0
openAcc                   0
pubRec                    0
pubRecBankruptcies      405
revolBal                  0
revolUtil               531
totalAcc                  0
initialListStatus         0
applicationType           0
earliesCreditLine         0
title                     1
policyCode                0
n0                    40270
n1                    40270
n2                    40270
n2.1                  40270
n4                    33239
n5                    40270
n6                    40270
n7                    40270
n8                    40271
n9                    40270
n10                   33239
n11                   69752
n12                   40270
n13                   40270
n14                   40270
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fill_type = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> fill_type == <span class="number">1</span>:</span><br><span class="line">    <span class="comment">#  缺失值替换为指定的值</span></span><br><span class="line">    data_train = data_train.fillna(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">elif</span> fill_type == <span class="number">2</span>:</span><br><span class="line">    <span class="comment"># 用上面的值替换缺失值</span></span><br><span class="line">    data_train = data_train.fillna(axis=<span class="number">0</span>,method=<span class="string">'ffill'</span>)</span><br><span class="line"><span class="keyword">elif</span> fill_type == <span class="number">3</span>:</span><br><span class="line">    <span class="comment"># 纵向用下面的值来替换，且最多只填充两个连续的</span></span><br><span class="line">    data_train = data_train.fillna(axis=<span class="number">0</span>,method=<span class="string">'bfill'</span>,limit=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#按照平均数填充数值型特征</span></span><br><span class="line">data_train[numerical_fea] = data_train[numerical_fea].fillna(data_train[numerical_fea].median())</span><br><span class="line">data_test_a[numerical_fea] = data_test_a[numerical_fea].fillna(data_train[numerical_fea].median())</span><br><span class="line"><span class="comment">#按照众数填充类别型特征</span></span><br><span class="line">data_train[category_fea] = data_train[category_fea].fillna(data_train[category_fea].mode())</span><br><span class="line">data_test_a[category_fea] = data_test_a[category_fea].fillna(data_train[category_fea].mode())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理没有结构化的数据 'issueDate' </span></span><br><span class="line">data_train.isnull().sum()</span><br><span class="line"><span class="comment"># 由于有些数据类型比如时间需要特别处理：['issueDate'] ['earliesCreditLine']</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [data_train, data_test_a]:</span><br><span class="line">    data[<span class="string">'issueDate'</span>] = pd.to_datetime(data[<span class="string">'issueDate'</span>],format=<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    startdate = datetime.datetime.strptime(<span class="string">'2007-06-01'</span>, <span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">    <span class="comment">#构造时间特征</span></span><br><span class="line">    data[<span class="string">'issueDateDT'</span>] = data[<span class="string">'issueDate'</span>].apply(<span class="keyword">lambda</span> x: x-startdate).dt.days</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data_train[<span class="string">'employmentLength'</span>].value_counts(dropna=<span class="literal">False</span>).sort_index()</span><br><span class="line"><span class="comment"># employmentLength 这一列特征中主要存储的是带信息的字符串稍微处理下变成int类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">employmentLength_to_int</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> pd.isnull(s):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> np.int8(s.split()[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [data_train, data_test_a]:</span><br><span class="line">    data[<span class="string">'employmentLength'</span>].replace(to_replace=<span class="string">'10+ years'</span>, value=<span class="string">'10 years'</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    data[<span class="string">'employmentLength'</span>].replace(<span class="string">'&lt; 1 year'</span>, <span class="string">'0 years'</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    data[<span class="string">'employmentLength'</span>] = data[<span class="string">'employmentLength'</span>].apply(employmentLength_to_int)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">'employmentLength'</span>].value_counts(dropna=<span class="literal">False</span>).sort_index()</span><br><span class="line"><span class="comment"># 可以看出数据的分布主要还是集中在10年以上</span></span><br></pre></td></tr></table></figure>
<pre><code>0.0     15989
1.0     13182
2.0     18207
3.0     16011
4.0     11833
5.0     12543
6.0      9328
7.0      8823
8.0      8976
9.0      7594
10.0    65772
NaN     11742
Name: employmentLength, dtype: int64
</code></pre><p>‘employmentLength’这个特征表示借款人最早报告的信用额度开立的月份 存储的时候是按照str存储的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_train[<span class="string">'earliesCreditLine'</span>].sample(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<pre><code>631614    May-2002
657973    Mar-1995
518715    Jan-2003
16630     Apr-1993
308502    Jun-2009
Name: earliesCreditLine, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于这个类型的特征由于时间跨度大所以只需要年份就行了</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [data_train, data_test_a]:</span><br><span class="line">    data[<span class="string">'earliesCreditLine'</span>] = data[<span class="string">'earliesCreditLine'</span>].apply(<span class="keyword">lambda</span> s: int(s[<span class="number">-4</span>:]))</span><br></pre></td></tr></table></figure>
<p>处理一些类别特征<br>用nunique() 可以找到不重复的类别有几种<br>grade 类型数： 7<br>subGrade 类型数： 35<br>employmentTitle 类型数： 79282<br>homeOwnership 类型数： 6<br>verificationStatus 类型数： 3<br>purpose 类型数： 14<br>postCode 类型数： 889<br>regionCode 类型数： 51<br>applicationType 类型数： 2<br>initialListStatus 类型数： 2<br>title 类型数： 12058<br>policyCode 类型数： 1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">semantic_dict = &#123;</span><br><span class="line">id:<span class="string">'为贷款清单分配的唯一信用证标识'</span>,</span><br><span class="line"><span class="string">'loanAmnt'</span>:<span class="string">'贷款金额'</span>,</span><br><span class="line"><span class="string">'term'</span> :<span class="string">'贷款期限（year）'</span>,</span><br><span class="line"><span class="string">'interestRate'</span>:<span class="string">'贷款利率'</span>,</span><br><span class="line"><span class="string">'installment'</span> :<span class="string">'分期付款金额'</span>,</span><br><span class="line"><span class="string">'grade'</span> :<span class="string">'贷款等级'</span>,</span><br><span class="line"><span class="string">'subGrade'</span> :<span class="string">'贷款等级之子级'</span>,</span><br><span class="line"><span class="string">'employmentTitle'</span> :<span class="string">'就业职称'</span>,</span><br><span class="line"><span class="string">'employmentLength'</span> :<span class="string">'就业年限（年）'</span>,</span><br><span class="line"><span class="string">'homeOwnership'</span> :<span class="string">'借款人在登记时提供的房屋所有权状况'</span>,</span><br><span class="line"><span class="string">'annualIncome'</span> :<span class="string">'年收入'</span>,</span><br><span class="line"><span class="string">'verificationStatus'</span> :<span class="string">'验证状态'</span>,</span><br><span class="line"><span class="string">'issueDate'</span> :<span class="string">'贷款发放的月份'</span>,</span><br><span class="line"><span class="string">'purpose'</span> :<span class="string">'借款人在贷款申请时的贷款用途类别'</span>,</span><br><span class="line"><span class="string">'postCode'</span> :<span class="string">'借款人在贷款申请中提供的邮政编码的前3位数字'</span>,</span><br><span class="line"><span class="string">'regionCode'</span> :<span class="string">'地区编码'</span>,</span><br><span class="line"><span class="string">'dti'</span> :<span class="string">'债务收入比'</span>,</span><br><span class="line"><span class="string">'delinquency_2years'</span> :<span class="string">'借款人过去2年信用档案中逾期30天以上的违约事件数'</span>,</span><br><span class="line"><span class="string">'ficoRangeLow'</span>:<span class="string">'借款人在贷款发放时的fico所属的下限范围'</span>,</span><br><span class="line"><span class="string">'ficoRangeHigh'</span>:<span class="string">'借款人在贷款发放时的fico所属的上限范围'</span>,</span><br><span class="line"><span class="string">'openAcc'</span>:<span class="string">'借款人信用档案中未结信用额度的数量'</span>,</span><br><span class="line"><span class="string">'pubRec'</span>:<span class="string">'贬损公共记录的数量'</span>,</span><br><span class="line"><span class="string">'pubRecBankruptcies'</span>:<span class="string">'公开记录清除的数量'</span>,</span><br><span class="line"><span class="string">'revolBal'</span>:<span class="string">'信贷周转余额合计'</span>,</span><br><span class="line"><span class="string">'revolUtil'</span>:<span class="string">'循环额度利用率，或借款人使用的相对于所有可用循环信贷的信贷金额'</span>,</span><br><span class="line"><span class="string">'totalAcc'</span>:<span class="string">'借款人信用档案中当前的信用额度总数'</span>,</span><br><span class="line"><span class="string">'initialListStatus'</span>:<span class="string">'贷款的初始列表状态'</span>,</span><br><span class="line"><span class="string">'applicationType'</span>:<span class="string">'表明贷款是个人申请还是与两个共同借款人的联合申请'</span>,</span><br><span class="line"><span class="string">'earliesCreditLine'</span>:<span class="string">'借款人最早报告的信用额度开立的月份'</span>,</span><br><span class="line"><span class="string">'title'</span>:<span class="string">'借款人提供的贷款名称'</span>,</span><br><span class="line"><span class="string">'policyCode'</span>:<span class="string">'公开可用的策略_代码=1新产品不公开可用的策略_代码=2n系列匿名特征 匿名特征n0-n14，为一些贷款人行为计数特征的处理'</span>,&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把grad映射一下</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [data_train, data_test_a]:</span><br><span class="line">    data[<span class="string">'grade'</span>] = data[<span class="string">'grade'</span>].map(&#123;<span class="string">'A'</span>:<span class="number">1</span>,<span class="string">'B'</span>:<span class="number">2</span>,<span class="string">'C'</span>:<span class="number">3</span>,<span class="string">'D'</span>:<span class="number">4</span>,<span class="string">'E'</span>:<span class="number">5</span>,<span class="string">'F'</span>:<span class="number">6</span>,<span class="string">'G'</span>:<span class="number">7</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [data_train, data_test_a]:</span><br><span class="line">    data = pd.get_dummies(data, columns=[<span class="string">'subGrade'</span>, <span class="string">'homeOwnership'</span>, <span class="string">'verificationStatus'</span>, <span class="string">'purpose'</span>, <span class="string">'regionCode'</span>], drop_first=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="异常值处理"><a href="#异常值处理" class="headerlink" title="异常值处理"></a>异常值处理</h3><ul>
<li>首先，如果这一异常值并不代表一种规律性的，而是极其偶然的现象，或者说你并不想研究这种偶然的现象，这时可以将其删除。</li>
<li>其次，如果异常值存在且代表了一种真实存在的现象，那就不能随便删除。在现有的欺诈场景中很多时候欺诈数据本身相对于正常数据说就是异常的，我们要把这些异常点纳入，重新拟合模型，研究其规律。能用监督的用监督模型，不能用的还可以考虑用异常检测的算法来做。</li>
<li>注意test的数据不能删。<br>让我们来分析一下数值型数据的异常值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用3sigma分析来找异常值，此时的data是[200000, 148], 增加的列编程了</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_outliers_by_3segama</span><span class="params">(data,fea)</span>:</span></span><br><span class="line">    data_std = np.std(data[fea])</span><br><span class="line">    data_mean = np.mean(data[fea])</span><br><span class="line">    outliers_cut_off = data_std * <span class="number">3</span></span><br><span class="line">    lower_rule = data_mean - outliers_cut_off</span><br><span class="line">    upper_rule = data_mean + outliers_cut_off</span><br><span class="line">    data[fea+<span class="string">'_outliers'</span>] = data[fea].apply(<span class="keyword">lambda</span> x:str(<span class="string">'异常值'</span>) <span class="keyword">if</span> x &gt; upper_rule <span class="keyword">or</span> x &lt; lower_rule <span class="keyword">else</span> <span class="string">'正常值'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">data_train = data_train.copy()</span><br><span class="line"><span class="keyword">for</span> fea <span class="keyword">in</span> numerical_fea:</span><br><span class="line">    data_train = find_outliers_by_3segama(data_train,fea)</span><br><span class="line">    print(data_train[fea+<span class="string">'_outliers'</span>].value_counts())</span><br><span class="line">    print(data_train.groupby(fea+<span class="string">'_outliers'</span>)[<span class="string">'isDefault'</span>].sum())</span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">10</span>)</span><br><span class="line"><span class="comment"># data_train[80w, 89]</span></span><br></pre></td></tr></table></figure>
<pre><code>正常值    800000
Name: id_outliers, dtype: int64
id_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    800000
Name: loanAmnt_outliers, dtype: int64
loanAmnt_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    800000
Name: term_outliers, dtype: int64
term_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    794259
异常值      5741
Name: interestRate_outliers, dtype: int64
interestRate_outliers
异常值      2916
正常值    156694
Name: isDefault, dtype: int64
**********
正常值    792046
异常值      7954
Name: installment_outliers, dtype: int64
installment_outliers
异常值      2152
正常值    157458
Name: isDefault, dtype: int64
**********
正常值    800000
Name: employmentTitle_outliers, dtype: int64
employmentTitle_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    799701
异常值       299
Name: homeOwnership_outliers, dtype: int64
homeOwnership_outliers
异常值        62
正常值    159548
Name: isDefault, dtype: int64
**********
正常值    793973
异常值      6027
Name: annualIncome_outliers, dtype: int64
annualIncome_outliers
异常值       756
正常值    158854
Name: isDefault, dtype: int64
**********
正常值    800000
Name: verificationStatus_outliers, dtype: int64
verificationStatus_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    783003
异常值     16997
Name: purpose_outliers, dtype: int64
purpose_outliers
异常值      3635
正常值    155975
Name: isDefault, dtype: int64
**********
正常值    798931
异常值      1069
Name: postCode_outliers, dtype: int64
postCode_outliers
异常值       221
正常值    159389
Name: isDefault, dtype: int64
**********
正常值    799994
异常值         6
Name: regionCode_outliers, dtype: int64
regionCode_outliers
异常值         1
正常值    159609
Name: isDefault, dtype: int64
**********
正常值    798440
异常值      1560
Name: dti_outliers, dtype: int64
dti_outliers
异常值       466
正常值    159144
Name: isDefault, dtype: int64
**********
正常值    778245
异常值     21755
Name: delinquency_2years_outliers, dtype: int64
delinquency_2years_outliers
异常值      5089
正常值    154521
Name: isDefault, dtype: int64
**********
正常值    788261
异常值     11739
Name: ficoRangeLow_outliers, dtype: int64
ficoRangeLow_outliers
异常值       778
正常值    158832
Name: isDefault, dtype: int64
**********
正常值    788261
异常值     11739
Name: ficoRangeHigh_outliers, dtype: int64
ficoRangeHigh_outliers
异常值       778
正常值    158832
Name: isDefault, dtype: int64
**********
正常值    790889
异常值      9111
Name: openAcc_outliers, dtype: int64
openAcc_outliers
异常值      2195
正常值    157415
Name: isDefault, dtype: int64
**********
正常值    792471
异常值      7529
Name: pubRec_outliers, dtype: int64
pubRec_outliers
异常值      1701
正常值    157909
Name: isDefault, dtype: int64
**********
正常值    794120
异常值      5880
Name: pubRecBankruptcies_outliers, dtype: int64
pubRecBankruptcies_outliers
异常值      1423
正常值    158187
Name: isDefault, dtype: int64
**********
正常值    790001
异常值      9999
Name: revolBal_outliers, dtype: int64
revolBal_outliers
异常值      1359
正常值    158251
Name: isDefault, dtype: int64
**********
正常值    799948
异常值        52
Name: revolUtil_outliers, dtype: int64
revolUtil_outliers
异常值        23
正常值    159587
Name: isDefault, dtype: int64
**********
正常值    791663
异常值      8337
Name: totalAcc_outliers, dtype: int64
totalAcc_outliers
异常值      1668
正常值    157942
Name: isDefault, dtype: int64
**********
正常值    800000
Name: initialListStatus_outliers, dtype: int64
initialListStatus_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    784586
异常值     15414
Name: applicationType_outliers, dtype: int64
applicationType_outliers
异常值      3875
正常值    155735
Name: isDefault, dtype: int64
**********
正常值    775134
异常值     24866
Name: title_outliers, dtype: int64
title_outliers
异常值      3900
正常值    155710
Name: isDefault, dtype: int64
**********
正常值    800000
Name: policyCode_outliers, dtype: int64
policyCode_outliers
正常值    159610
Name: isDefault, dtype: int64
**********
正常值    782773
异常值     17227
Name: n0_outliers, dtype: int64
n0_outliers
异常值      3485
正常值    156125
Name: isDefault, dtype: int64
**********
正常值    790500
异常值      9500
Name: n1_outliers, dtype: int64
n1_outliers
异常值      2491
正常值    157119
Name: isDefault, dtype: int64
**********
正常值    789067
异常值     10933
Name: n2_outliers, dtype: int64
n2_outliers
异常值      3205
正常值    156405
Name: isDefault, dtype: int64
**********
正常值    789067
异常值     10933
Name: n2.1_outliers, dtype: int64
n2.1_outliers
异常值      3205
正常值    156405
Name: isDefault, dtype: int64
**********
正常值    788660
异常值     11340
Name: n4_outliers, dtype: int64
n4_outliers
异常值      2476
正常值    157134
Name: isDefault, dtype: int64
**********
正常值    790355
异常值      9645
Name: n5_outliers, dtype: int64
n5_outliers
异常值      1858
正常值    157752
Name: isDefault, dtype: int64
**********
正常值    786006
异常值     13994
Name: n6_outliers, dtype: int64
n6_outliers
异常值      3182
正常值    156428
Name: isDefault, dtype: int64
**********
正常值    788430
异常值     11570
Name: n7_outliers, dtype: int64
n7_outliers
异常值      2746
正常值    156864
Name: isDefault, dtype: int64
**********
正常值    789625
异常值     10375
Name: n8_outliers, dtype: int64
n8_outliers
异常值      2131
正常值    157479
Name: isDefault, dtype: int64
**********
正常值    786384
异常值     13616
Name: n9_outliers, dtype: int64
n9_outliers
异常值      3953
正常值    155657
Name: isDefault, dtype: int64
**********
正常值    788979
异常值     11021
Name: n10_outliers, dtype: int64
n10_outliers
异常值      2639
正常值    156971
Name: isDefault, dtype: int64
**********
正常值    799434
异常值       566
Name: n11_outliers, dtype: int64
n11_outliers
异常值       112
正常值    159498
Name: isDefault, dtype: int64
**********
正常值    797585
异常值      2415
Name: n12_outliers, dtype: int64
n12_outliers
异常值       545
正常值    159065
Name: isDefault, dtype: int64
**********
正常值    788907
异常值     11093
Name: n13_outliers, dtype: int64
n13_outliers
异常值      2482
正常值    157128
Name: isDefault, dtype: int64
**********
正常值    788884
异常值     11116
Name: n14_outliers, dtype: int64
n14_outliers
异常值      3364
正常值    156246
Name: isDefault, dtype: int64
**********
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除异常值对应的行</span></span><br><span class="line"><span class="keyword">for</span> fea <span class="keyword">in</span> numerical_fea:</span><br><span class="line">    data_train = data_train[data_train[fea+<span class="string">'_outliers'</span>]==<span class="string">'正常值'</span>]</span><br><span class="line">    data_train = data_train.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="数据分桶"><a href="#数据分桶" class="headerlink" title="数据分桶"></a>数据分桶</h3><p>将一些连续数据比如999，99，8这种连续数据离散化来处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过除法映射到间隔均匀的分箱中，每个分箱的取值范围都是loanAmnt/1000</span></span><br><span class="line">data[<span class="string">'loanAmnt_bin1'</span>] = np.floor_divide(data[<span class="string">'loanAmnt'</span>], <span class="number">1000</span>)</span><br><span class="line"><span class="comment">## 通过对数函数映射到指数宽度分箱</span></span><br><span class="line">data[<span class="string">'loanAmnt_bin2'</span>] = np.floor(np.log10(data[<span class="string">'loanAmnt'</span>]))</span><br><span class="line"><span class="comment">## 分位数分箱</span></span><br><span class="line">data[<span class="string">'loanAmnt_bin3'</span>] = pd.qcut(data[<span class="string">'loanAmnt'</span>], <span class="number">10</span>, labels=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<h3 id="特征编码"><a href="#特征编码" class="headerlink" title="特征编码"></a>特征编码</h3><p>labelEncode 直接放入树模型中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#label-encode:subGrade,postCode,title</span></span><br><span class="line"><span class="comment"># 高维类别特征需要进行转换</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> tqdm([<span class="string">'employmentTitle'</span>, <span class="string">'postCode'</span>, <span class="string">'title'</span>,<span class="string">'subGrade'</span>]):</span><br><span class="line">    le = LabelEncoder()</span><br><span class="line">    le.fit(list(data_train[col].astype(str).values) + list(data_test_a[col].astype(str).values))</span><br><span class="line">    data_train[col] = le.transform(list(data_train[col].astype(str).values))</span><br><span class="line">    data_test_a[col] = le.transform(list(data_test_a[col].astype(str).values))</span><br><span class="line">print(<span class="string">'Label Encoding 完成'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>100%|██████████| 4/4 [00:03&lt;00:00,  1.13it/s]


Label Encoding 完成
</code></pre><p>逻辑回归等模型要单独增加的特征工程</p>
<ul>
<li>对特征做归一化，去除相关性高的特征</li>
<li>归一化目的是让训练过程更好更快的收敛，避免特征大吃小的问题</li>
<li>去除相关性是增加模型的可解释性，加快预测过程。</li>
</ul>
<h3 id="特征选择"><a href="#特征选择" class="headerlink" title="特征选择"></a>特征选择</h3><p>特征选择技术可以精简掉无用的特征，以降低最终模型的复杂性，它的最终目的是得到一个简约模型，<br>在不降低预测准确率或对预测准确率影响不大的情况下提高计算速度。特征选择不是为了减少训练时间<br>（实际上，一些技术会增加总体训练时间），而是为了减少模型评分时间。</p>
<ul>
<li>Filter<ul>
<li>方差选择法</li>
<li>相关系数法（pearson 相关系数）</li>
<li>卡方检验</li>
<li>互信息法</li>
</ul>
</li>
<li>2 Wrapper （RFE）<ul>
<li>递归特征消除法</li>
</ul>
</li>
<li>3 Embedded<ul>
<li>基于惩罚项的特征选择法</li>
<li>基于树模型的特征选择</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"纵向用缺失值上面的值替换缺失值"</span></span><br><span class="line">data_train = data_train.fillna(axis=<span class="number">0</span>,method=<span class="string">'ffill'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x_train = data_train</span><br><span class="line"><span class="comment">#计算协方差</span></span><br><span class="line">data_corr = x_train.corrwith(data_train.isDefault) <span class="comment">#计算相关性</span></span><br><span class="line">result = pd.DataFrame(columns=[<span class="string">'features'</span>, <span class="string">'corr'</span>])</span><br><span class="line">result[<span class="string">'features'</span>] = data_corr.index</span><br><span class="line">result[<span class="string">'corr'</span>] = data_corr.values</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当然也可以直接看图</span></span><br><span class="line">data_numeric = data_train[numerical_fea]</span><br><span class="line">correlation = data_numeric.corr()</span><br><span class="line"></span><br><span class="line">f , ax = plt.subplots(figsize = (<span class="number">7</span>, <span class="number">7</span>))</span><br><span class="line">plt.title(<span class="string">'Correlation of Numeric Features with Price'</span>,y=<span class="number">1</span>,size=<span class="number">16</span>)</span><br><span class="line">sns.heatmap(correlation,square = <span class="literal">True</span>,  vmax=<span class="number">0.8</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x16522246898&gt;
</code></pre><p><img src="output_31_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">features = [f <span class="keyword">for</span> f <span class="keyword">in</span> data_train.columns <span class="keyword">if</span> f <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'id'</span>,<span class="string">'issueDate'</span>,<span class="string">'isDefault'</span>] <span class="keyword">and</span> <span class="string">'_outliers'</span> <span class="keyword">not</span> <span class="keyword">in</span> f]</span><br><span class="line">x_train = data_train[features]</span><br><span class="line">x_test = data_test_a[features]</span><br><span class="line">y_train = data_train[<span class="string">'isDefault'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv_model</span><span class="params">(clf, train_x, train_y, test_x, clf_name)</span>:</span></span><br><span class="line">    folds = <span class="number">5</span></span><br><span class="line">    seed = <span class="number">2020</span></span><br><span class="line">    kf = KFold(n_splits=folds, shuffle=<span class="literal">True</span>, random_state=seed)</span><br><span class="line"></span><br><span class="line">    train = np.zeros(train_x.shape[<span class="number">0</span>])</span><br><span class="line">    test = np.zeros(test_x.shape[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    cv_scores = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (train_index, valid_index) <span class="keyword">in</span> enumerate(kf.split(train_x, train_y)):</span><br><span class="line">        print(<span class="string">'************************************ &#123;&#125; ************************************'</span>.format(str(i+<span class="number">1</span>)))</span><br><span class="line">        trn_x, trn_y, val_x, val_y = train_x.iloc[train_index], train_y[train_index], train_x.iloc[valid_index], train_y[valid_index]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> clf_name == <span class="string">"lgb"</span>:</span><br><span class="line">            train_matrix = clf.Dataset(trn_x, label=trn_y)</span><br><span class="line">            valid_matrix = clf.Dataset(val_x, label=val_y)</span><br><span class="line"></span><br><span class="line">            params = &#123;</span><br><span class="line">                <span class="string">'boosting_type'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">                <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">                <span class="string">'metric'</span>: <span class="string">'auc'</span>,</span><br><span class="line">                <span class="string">'min_child_weight'</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="string">'num_leaves'</span>: <span class="number">2</span> ** <span class="number">5</span>,</span><br><span class="line">                <span class="string">'lambda_l2'</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="string">'feature_fraction'</span>: <span class="number">0.8</span>,</span><br><span class="line">                <span class="string">'bagging_fraction'</span>: <span class="number">0.8</span>,</span><br><span class="line">                <span class="string">'bagging_freq'</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="string">'learning_rate'</span>: <span class="number">0.1</span>,</span><br><span class="line">                <span class="string">'seed'</span>: <span class="number">2020</span>,</span><br><span class="line">                <span class="string">'nthread'</span>: <span class="number">28</span>,</span><br><span class="line">                <span class="string">'n_jobs'</span>:<span class="number">24</span>,</span><br><span class="line">                <span class="string">'silent'</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'verbose'</span>: <span class="number">-1</span>,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            model = clf.train(params, train_matrix, <span class="number">50000</span>, valid_sets=[train_matrix, valid_matrix], verbose_eval=<span class="number">200</span>,early_stopping_rounds=<span class="number">200</span>)</span><br><span class="line">            val_pred = model.predict(val_x, num_iteration=model.best_iteration)</span><br><span class="line">            test_pred = model.predict(test_x, num_iteration=model.best_iteration)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># print(list(sorted(zip(features, model.feature_importance("gain")), key=lambda x: x[1], reverse=True))[:20])</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">if</span> clf_name == <span class="string">"xgb"</span>:</span><br><span class="line">            train_matrix = clf.DMatrix(trn_x , label=trn_y)</span><br><span class="line">            valid_matrix = clf.DMatrix(val_x , label=val_y)</span><br><span class="line">            </span><br><span class="line">            params = &#123;<span class="string">'booster'</span>: <span class="string">'gbtree'</span>,</span><br><span class="line">                      <span class="string">'objective'</span>: <span class="string">'binary:logistic'</span>,</span><br><span class="line">                      <span class="string">'eval_metric'</span>: <span class="string">'auc'</span>,</span><br><span class="line">                      <span class="string">'gamma'</span>: <span class="number">1</span>,</span><br><span class="line">                      <span class="string">'min_child_weight'</span>: <span class="number">1.5</span>,</span><br><span class="line">                      <span class="string">'max_depth'</span>: <span class="number">5</span>,</span><br><span class="line">                      <span class="string">'lambda'</span>: <span class="number">10</span>,</span><br><span class="line">                      <span class="string">'subsample'</span>: <span class="number">0.7</span>,</span><br><span class="line">                      <span class="string">'colsample_bytree'</span>: <span class="number">0.7</span>,</span><br><span class="line">                      <span class="string">'colsample_bylevel'</span>: <span class="number">0.7</span>,</span><br><span class="line">                      <span class="string">'eta'</span>: <span class="number">0.04</span>,</span><br><span class="line">                      <span class="string">'tree_method'</span>: <span class="string">'exact'</span>,</span><br><span class="line">                      <span class="string">'seed'</span>: <span class="number">2020</span>,</span><br><span class="line">                      <span class="string">'nthread'</span>: <span class="number">36</span>,</span><br><span class="line">                      <span class="string">"silent"</span>: <span class="literal">True</span>,</span><br><span class="line">                      &#125;</span><br><span class="line">            </span><br><span class="line">            watchlist = [(train_matrix, <span class="string">'train'</span>),(valid_matrix, <span class="string">'eval'</span>)]</span><br><span class="line">            </span><br><span class="line">            model = clf.train(params, train_matrix, num_boost_round=<span class="number">50000</span>, evals=watchlist, verbose_eval=<span class="number">200</span>, early_stopping_rounds=<span class="number">200</span>)</span><br><span class="line">            val_pred  = model.predict(valid_matrix, ntree_limit=model.best_ntree_limit)</span><br><span class="line">            test_pred = model.predict(test_x , ntree_limit=model.best_ntree_limit)</span><br><span class="line">                 </span><br><span class="line">        <span class="keyword">if</span> clf_name == <span class="string">"cat"</span>:</span><br><span class="line">            params = &#123;<span class="string">'learning_rate'</span>: <span class="number">0.05</span>, <span class="string">'depth'</span>: <span class="number">5</span>, <span class="string">'l2_leaf_reg'</span>: <span class="number">10</span>, <span class="string">'bootstrap_type'</span>: <span class="string">'Bernoulli'</span>,</span><br><span class="line">                      <span class="string">'od_type'</span>: <span class="string">'Iter'</span>, <span class="string">'od_wait'</span>: <span class="number">50</span>, <span class="string">'random_seed'</span>: <span class="number">11</span>, <span class="string">'allow_writing_files'</span>: <span class="literal">False</span>&#125;</span><br><span class="line">            </span><br><span class="line">            model = clf(iterations=<span class="number">20000</span>, **params)</span><br><span class="line">            model.fit(trn_x, trn_y, eval_set=(val_x, val_y),</span><br><span class="line">                      cat_features=[], use_best_model=<span class="literal">True</span>, verbose=<span class="number">500</span>)</span><br><span class="line">            </span><br><span class="line">            val_pred  = model.predict(val_x)</span><br><span class="line">            test_pred = model.predict(test_x)</span><br><span class="line">            </span><br><span class="line">        train[valid_index] = val_pred</span><br><span class="line">        test = test_pred / kf.n_splits</span><br><span class="line">        cv_scores.append(roc_auc_score(val_y, val_pred))</span><br><span class="line">        </span><br><span class="line">        print(cv_scores)</span><br><span class="line">        </span><br><span class="line">    print(<span class="string">"%s_scotrainre_list:"</span> % clf_name, cv_scores)</span><br><span class="line">    print(<span class="string">"%s_score_mean:"</span> % clf_name, np.mean(cv_scores))</span><br><span class="line">    print(<span class="string">"%s_score_std:"</span> % clf_name, np.std(cv_scores))</span><br><span class="line">    <span class="keyword">return</span> train, test</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lgb_model</span><span class="params">(x_train, y_train, x_test)</span>:</span></span><br><span class="line">    lgb_train, lgb_test = cv_model(lgb, x_train, y_train, x_test, <span class="string">"lgb"</span>)</span><br><span class="line">    <span class="keyword">return</span> lgb_train, lgb_test</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xgb_model</span><span class="params">(x_train, y_train, x_test)</span>:</span></span><br><span class="line">    xgb_train, xgb_test = cv_model(xgb, x_train, y_train, x_test, <span class="string">"xgb"</span>)</span><br><span class="line">    <span class="keyword">return</span> xgb_train, xgb_test</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cat_model</span><span class="params">(x_train, y_train, x_test)</span>:</span></span><br><span class="line">    cat_train, cat_test = cv_model(CatBoostRegressor, x_train, y_train, x_test, <span class="string">"cat"</span>)</span><br><span class="line"></span><br><span class="line">lgb_train, lgb_test = lgb_model(x_train, y_train, x_test)</span><br></pre></td></tr></table></figure>
<pre><code>************************************ 1 ************************************
[LightGBM] [Warning] num_threads is set with nthread=28, will be overridden by n_jobs=24. Current value: num_threads=24
[LightGBM] [Warning] Unknown parameter: silent
Training until validation scores don&#39;t improve for 200 rounds
[200]    training&#39;s auc: 0.748799    valid_1&#39;s auc: 0.730081
[400]    training&#39;s auc: 0.764154    valid_1&#39;s auc: 0.730891
[600]    training&#39;s auc: 0.777375    valid_1&#39;s auc: 0.730927
Early stopping, best iteration is:
[439]    training&#39;s auc: 0.766861    valid_1&#39;s auc: 0.731
[0.7310002011064074]
************************************ 2 ************************************
[LightGBM] [Warning] num_threads is set with nthread=28, will be overridden by n_jobs=24. Current value: num_threads=24
[LightGBM] [Warning] Unknown parameter: silent
Training until validation scores don&#39;t improve for 200 rounds
[200]    training&#39;s auc: 0.748535    valid_1&#39;s auc: 0.731631
[400]    training&#39;s auc: 0.764256    valid_1&#39;s auc: 0.732332
Early stopping, best iteration is:
[345]    training&#39;s auc: 0.76031    valid_1&#39;s auc: 0.732483
[0.7310002011064074, 0.7324829219213177]
************************************ 3 ************************************
[LightGBM] [Warning] num_threads is set with nthread=28, will be overridden by n_jobs=24. Current value: num_threads=24
[LightGBM] [Warning] Unknown parameter: silent
Training until validation scores don&#39;t improve for 200 rounds
[200]    training&#39;s auc: 0.747855    valid_1&#39;s auc: 0.73267
[400]    training&#39;s auc: 0.763207    valid_1&#39;s auc: 0.733776
[600]    training&#39;s auc: 0.776409    valid_1&#39;s auc: 0.734096
[800]    training&#39;s auc: 0.788911    valid_1&#39;s auc: 0.733663
Early stopping, best iteration is:
[628]    training&#39;s auc: 0.778126    valid_1&#39;s auc: 0.734146
[0.7310002011064074, 0.7324829219213177, 0.7341455481432986]
************************************ 4 ************************************
[LightGBM] [Warning] num_threads is set with nthread=28, will be overridden by n_jobs=24. Current value: num_threads=24
[LightGBM] [Warning] Unknown parameter: silent
Training until validation scores don&#39;t improve for 200 rounds
[200]    training&#39;s auc: 0.749233    valid_1&#39;s auc: 0.727753
[400]    training&#39;s auc: 0.764767    valid_1&#39;s auc: 0.728777
[600]    training&#39;s auc: 0.777702    valid_1&#39;s auc: 0.728611
Early stopping, best iteration is:
[420]    training&#39;s auc: 0.766087    valid_1&#39;s auc: 0.728853
[0.7310002011064074, 0.7324829219213177, 0.7341455481432986, 0.7288532795103251]
************************************ 5 ************************************
[LightGBM] [Warning] num_threads is set with nthread=28, will be overridden by n_jobs=24. Current value: num_threads=24
[LightGBM] [Warning] Unknown parameter: silent
Training until validation scores don&#39;t improve for 200 rounds
[200]    training&#39;s auc: 0.748281    valid_1&#39;s auc: 0.733124
[400]    training&#39;s auc: 0.763463    valid_1&#39;s auc: 0.733781
[600]    training&#39;s auc: 0.776921    valid_1&#39;s auc: 0.733684
Early stopping, best iteration is:
[536]    training&#39;s auc: 0.772805    valid_1&#39;s auc: 0.733891
[0.7310002011064074, 0.7324829219213177, 0.7341455481432986, 0.7288532795103251, 0.7338908945947943]
lgb_scotrainre_list: [0.7310002011064074, 0.7324829219213177, 0.7341455481432986, 0.7288532795103251, 0.7338908945947943]
lgb_score_mean: 0.7320745690552286
lgb_score_std: 0.0019639611876869616
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testA_result = pd.read_csv(<span class="string">'./testA.csv'</span>)</span><br><span class="line">roc_auc_score(testA_result[<span class="string">'isDefault'</span>].values, lgb_test)</span><br></pre></td></tr></table></figure>
<pre><code>---------------------------------------------------------------------------

KeyError                                  Traceback (most recent call last)

~\anaconda3\envs\tf13\lib\site-packages\pandas\core\indexes\base.py in get_loc(self, key, method, tolerance)
   2888             try:
-&gt; 2889                 return self._engine.get_loc(casted_key)
   2890             except KeyError as err:


pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()


pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()


pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()


pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()


KeyError: &#39;isDefault&#39;
</code></pre><p>​<br>    The above exception was the direct cause of the following exception:</p>
<pre><code>KeyError                                  Traceback (most recent call last)

&lt;ipython-input-69-262e8275a2db&gt; in &lt;module&gt;
      1 testA_result = pd.read_csv(&#39;./testA.csv&#39;)
----&gt; 2 roc_auc_score(testA_result[&#39;isDefault&#39;].values, lgb_test)
      3 


~\anaconda3\envs\tf13\lib\site-packages\pandas\core\frame.py in __getitem__(self, key)
   2897             if self.columns.nlevels &gt; 1:
   2898                 return self._getitem_multilevel(key)
-&gt; 2899             indexer = self.columns.get_loc(key)
   2900             if is_integer(indexer):
   2901                 indexer = [indexer]


~\anaconda3\envs\tf13\lib\site-packages\pandas\core\indexes\base.py in get_loc(self, key, method, tolerance)
   2889                 return self._engine.get_loc(casted_key)
   2890             except KeyError as err:
-&gt; 2891                 raise KeyError(key) from err
   2892 
   2893         if tolerance is not None:


KeyError: &#39;isDefault&#39;
</code></pre>
      
    </div>
    
    
    

    <div>
      
      <div>
    
    <div style="text-align:center;color:#ccc;font-size:14px;">
        -------------本文结束<i class="fa fa-paw"></i>感谢您的阅读 :D -------------
    </div>
    
</div>

      
    </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/datawhal-RiskControl/" rel="tag"># datawhal, RiskControl</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/09/15/DW金融风控比赛项目任务一赛题理解/" rel="next" title="金融风控比赛项目任务一赛题理解">
                <i class="fa fa-chevron-left"></i> 金融风控比赛项目任务一赛题理解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div onclick="showGitment()" id="gitment-display-button">Show comments from Gitment</div>
        <div id="gitment-container" style="display:none"></div>
      
    </div>

  
  

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Ritarma Arthur</p>
              <p class="site-description motion-element" itemprop="description">The place for Rita show his learning notes and personal insights</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ritarma" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="17888803324@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据预处理"><span class="nav-number">1.</span> <span class="nav-text">数据预处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缺失值填充"><span class="nav-number">1.1.</span> <span class="nav-text">缺失值填充</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常值处理"><span class="nav-number">1.2.</span> <span class="nav-text">异常值处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据分桶"><span class="nav-number">1.3.</span> <span class="nav-text">数据分桶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特征编码"><span class="nav-number">1.4.</span> <span class="nav-text">特征编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特征选择"><span class="nav-number">1.5.</span> <span class="nav-text">特征选择</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ritarma Arthur</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">15.1k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共15.1k字</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("ojcbqkb3SnJe2sd0GMeDW4kH-gzGz0Hsz", "RTunh8RXw3C64UNppKWB9KDJ");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
